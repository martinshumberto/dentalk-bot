{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./app.js","webpack:///./app/profile.js","webpack:///./app/receive.js","webpack:///./app/send.js","webpack:///./app/webhook.js","webpack:///./config/mysql.js","webpack:///./config/variables.js","webpack:///./models/calendar.model.js","webpack:///./models/user.model.js","webpack:///./routes/profile.route.js","webpack:///./routes/webhook.route.js","webpack:///./services/calendar.service.js","webpack:///./services/dialogflow.service.js","webpack:///./services/facebook.service.js","webpack:///./utils/index.js","webpack:///./utils/structjson.js","webpack:///external \"@babel/runtime/helpers/asyncToGenerator\"","webpack:///external \"@babel/runtime/helpers/defineProperty\"","webpack:///external \"@babel/runtime/helpers/typeof\"","webpack:///external \"@babel/runtime/regenerator\"","webpack:///external \"body-parser\"","webpack:///external \"cors\"","webpack:///external \"dialogflow\"","webpack:///external \"dotenv\"","webpack:///external \"express\"","webpack:///external \"googleapis\"","webpack:///external \"moment\"","webpack:///external \"mysql\"","webpack:///external \"pb-util\"","webpack:///external \"request\"","webpack:///external \"uuid\""],"names":["dotenv","config","app","express","use","bodyParser","json","urlencoded","extended","cors","__dirname","checkEnv","webhookRoute","profileRoute","get","req","res","mysql","execQuery","leads","status","send","events","err","render","message","error","listen","PORT","console","log","APP_URL","SITE_URL","FB_VERIFY_TOKEN","FB_PAGE_ID","setWebhook","facebookAPI","callSubscriptionsAPI","callSubscribedApps","setPageFeedWebhook","setThread","profilePayload","getGetStarted","getGreeting","getPersistentMenu","callMessengerProfileAPI","get_started","payload","greetings","push","getGreetingText","greeting","menuItems","getMenuItems","persistent_menu","localizedGreeting","locale","text","NAME_COMPANY","localizedMenu","composer_input_disabled","call_to_actions","title","type","url","webview_height_ratio","getWhitelistedDomains","whitelistedDomains","whitelisted_domains","setGetStarted","getStartedPayload","setGreeting","greetingPayload","setPersistentMenu","menuPayload","setWhitelistedDomains","domainPayload","handleCardMessages","messages","sender","elements","m","length","buttons","b","card","isLink","postback","substring","button","element","image_url","imageUri","subtitle","sendGenericMessage","handleMessages","timeoutInterval","previousType","cardTypes","timeout","i","setTimeout","bind","handleMessage","handleMsgObj","forEach","sendTextMessage","replies","quickReplies","reply","content_type","sendQuickReply","sendImageMessage","image","struct","decode","verifyPerson","facebook","person_true","messageData","recipient","id","sendCall","handleQuickReply","senderID","quickReply","messageId","quickReplyPayload","dialogflowAPI","sendTextToDialogFlow","handleMessageAttachments","messageAttachments","handleDialogFlowResponse","response","responseText","fulfillmentMessages","fulfillmentText","action","contexts","outputContexts","parameters","delay","utils","isDefined","sendTypingOn","sendTypingOff","handleDialogFlowAction","handleDFAObj","user","usersMap","userDB","welcome","Promise","resolve","first_name","about","copy","getPhone","getEmail","onboarding","first","restart","phone","email","then","fields","stringValue","missingSlots","userModel","getUserDB","calendarModel","getEvent","event","moment","start","format","date","time","dateTimeStart","Date","parse","split","calendarAPI","slotsFromEvents","resTime","hour","today","dateTimeEnd","add","daysFromSlots","days","daysRefine","day","startDate","month","weekDay","filter","a","JSON","stringify","Object","create","setHours","getHours","appointmentTimeString","createCalendarEvent","data","getEventID","eventID","htmlLink","summary","description","dateTime","end","sendButtonMessage","erro","updateCalendarEvent","deleteCalendarEvent","cancelEvent","default_action","sendPassThread","handleEcho","appId","metadata","receivedMessage","recipientID","timeOfMessage","timestamp","setSessionandUser","isEcho","is_echo","mid","FB_APP_ID","messageText","attachments","quick_reply","receivedPbObj","sendEventToDialogFlow","receivedPostback","timeOfPostback","receivedMessageRead","watermark","read","sequenceNumber","seq","receivedAuthentication","timeOfAuth","passThroughParam","optin","ref","receivedAccountLink","account_linking","authCode","authorization_code","receivedDeliveryConfirmation","delivery","messageIDs","mids","messageID","recipientId","sender_action","sendTextWithPersona","persona_id","sendGifMessage","GifName","attachment","imageName","quick_replies","template_type","process","env","DEBUG","messageHandler","body","object","entry","pageEntry","hookEvent","messaging","senderPsid","standby","psid","messagingEvent","receive","pass_thread_control","verifyWebhook","mode","query","challenge","token","setProfile","startsWith","profile","write","callNLPConfigsAPI","sendStatus","connection","createConnection","host","port","password","database","sqlQry","reject","results","code","require","ENV_VARS","mPlatformDomain","mPlatformVersion","APP_EMAIL","FB_APP_SECRET","FB_PAGE_ACCESS_TOKEN","GOOGLE_CLIENT_EMAIL","GOOGLE_PROJECT_ID","GOOGLE_LANGUAGE_CODE","GOOGLE_PRIVATE_KEY","GOOGLE_CALENDAR_ID","mPlatfom","webhookUrl","key","includes","route","webhook","post","serviceAccountAuth","google","auth","JWT","scopes","calendar","list","calendarId","timeMin","toISOString","timeMax","calendarResponse","items","Error","insert","resource","last_name","eventId","patch","currentlyOpen","parseInt","setMinutes","getMinutes","getDay","startTime","endTime","endDate","check","timeZone","freebusy","receivedSlotsDays","calendars","busy","freeSlots","index","receivedSlotsHours","start_org","end_org","start_time","end_time","valueOf","appt_start_time","getTime","appt_end_time","slot_available","this_start","this_end","credentials","private_key","client_email","sessionClient","dialogflow","SessionsClient","textString","params","sessionPath","sessionIds","request","session","queryInput","languageCode","queryParams","detectIntent","responses","result","queryResult","name","structjson","jsonToStructProto","callback","uri","qs","access_token","method","statusCode","recipient_id","message_id","statusMessage","target_app_id","_res","requestBody","getUserProfile","callUserProfileAPI","userProfile","keysUserProfile","keys","valuesUserProfile","values","prototype","hasOwnProperty","call","value","on","chunk","Buffer","concat","toString","nlp_enabled","callFBAEventsAPI","eventName","custom_events","_eventName","_value","_origin","advertiser_tracking_enabled","application_tracking_enabled","extinfo","pageId","page_scoped_user_id","form","customFields","undefined","callback_url","verify_token","include_values","subscribed_fields","addUser","userId","consulta","profile_pic","uuid","obj","resolveAfterXSeconds","x","Map","has","set","v4","slice","partes","parte","chaveValor","valor","buf","from","k","jsonValueToProto","JSON_SIMPLE_TYPE_TO_PROTO_KIND_MAP","JSON_SIMPLE_VALUE_KINDS","Set","valueProto","kind","nullValue","Array","listValue","map","structValue","warn","structProtoToJson","proto","valueProtoToJson"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","'use strict';\n\n/*\n ** Import packages\n */\n\nimport dotenv from 'dotenv';\nimport express from 'express';\nimport bodyParser from 'body-parser';\nimport cors from 'cors';\nimport config from './config/variables';\nimport mysql from './config/mysql';\nimport profileRoute from './routes/profile.route';\nimport webhookRoute from './routes/webhook.route';\n\ndotenv.config();\n\nconst app = express();\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\napp.use(cors());\napp.use(express.static(__dirname + '/static'));\n\nconfig.checkEnv();\n\n/*\n ** Routes configuration\n */\n\nwebhookRoute(app);\nprofileRoute(app);\n\napp.get('/leads', async (req, res) =>{\n    const leads = await mysql.execQuery('SELECT * FROM leads');\n    res.status(200).send(leads);\n});\napp.get('/events', async (req, res) =>{\n    const events = await mysql.execQuery('SELECT * FROM calendar_events');\n    res.status(200).send(events);\n});\n\n/*\n ** Middleware configuration\n */\n\n// error handlers\n\n// development error handler\n// will print stacktrace\nif (app.get('env') === 'development') {\n    app.use(function(err, req, res) {\n        res.status(err.status || 500);\n        res.render('error', {\n            message: err.message,\n            error: err\n        });\n    });\n}\n\n// production error handler\n// no stacktraces leaked to user\napp.use(function(err, req, res) {\n    res.status(err.status || 500);\n    res.render('error', {\n        message: err.message,\n        error: {}\n    });\n});\n\napp.listen(config.PORT, () => {\n    console.log('⚡️ [BOT CONSILIO] Express server is listening.');\n\n    if (\n        config.APP_URL &&\n        config.SITE_URL\n    ) {\n        console.log(\n            '⚡️ [BOT CONSILIO] Make sure to set the both the Messenger profile ' +\n        'and webhook by visiting:\\n⚡️ [BOT CONSILIO] ' +\n        config.APP_URL +\n        '/profile?mode=all&verify_token=' +\n        config.FB_VERIFY_TOKEN\n        );\n    }\n    if (config.FB_PAGE_ID) {\n        console.log('⚡️ [BOT CONSILIO] Test app by messaging:');\n        console.log('⚡️ [BOT CONSILIO] https://m.me/' + config.FB_PAGE_ID);\n    }\n});\n\n/*\n ** Base view\n */\napp.get('/', (req, res) => {\n    res.send('⚡️[BOT CONSILIO] Hello world!');\n});","import config from '../config/variables';\nimport facebookAPI from '../services/facebook.service';\n\nexport default {\n\n    setWebhook() {\n        facebookAPI.callSubscriptionsAPI();\n        facebookAPI.callSubscribedApps();\n    },\n\n    setPageFeedWebhook() {\n        facebookAPI.callSubscriptionsAPI('feed');\n        facebookAPI.callSubscribedApps('feed');\n    },\n\n    setThread() {\n        let profilePayload = {\n            ...this.getGetStarted(),\n            ...this.getGreeting(),\n            ...this.getPersistentMenu()\n        };\n\n        facebookAPI.callMessengerProfileAPI(profilePayload);\n    },\n\n    getGetStarted() {\n        return {\n            get_started: {\n                payload: 'get_started'\n            }\n        };\n    },\n\n    getGreeting() {\n        let greetings = [];\n        greetings.push(this.getGreetingText());\n\n        return {\n            greeting: greetings\n        };\n    },\n\n    getPersistentMenu() {\n        let menuItems = [];\n\n        menuItems.push(this.getMenuItems());\n\n        return {\n            persistent_menu: menuItems\n        };\n    },\n\n    getGreetingText() {\n        let localizedGreeting = {\n            locale: 'default',\n            text:\n        `Oi {{user_first_name}}! Clique em COMEÇAR para saber como nós da ${config.NAME_COMPANY} podemos te ajudar hoje!👇`\n        };\n\n        return localizedGreeting;\n    },\n\n    getMenuItems() {\n        let localizedMenu = {\n            locale: 'default',\n            composer_input_disabled: false,\n            call_to_actions: [\n                {\n                    title: 'Atendimento',\n                    type: 'nested',\n                    call_to_actions: [\n                        {\n                            title: 'Menu 1',\n                            type: 'postback',\n                            payload: 'Lorem ipsum'\n                        },\n                    ]\n                },\n                {\n                    title: 'E-book gratuito',\n                    type: 'postback',\n                    payload: 'CARE_HELP'\n                },\n                {\n                    type: 'web_url',\n                    title: 'Acessar site',\n                    url: config.SITE_URL,\n                    webview_height_ratio: 'full'\n                }\n            ]\n        };\n        return localizedMenu;\n    },\n\n    getWhitelistedDomains() {\n        let whitelistedDomains = {\n            whitelisted_domains: config.whitelistedDomains\n        };\n\n        return whitelistedDomains;\n    },\n\n    setGetStarted() {\n        let getStartedPayload = this.getGetStarted();\n        facebookAPI.callMessengerProfileAPI(getStartedPayload);\n    },\n\n    setGreeting() {\n        let greetingPayload = this.getGreeting();\n        facebookAPI.callMessengerProfileAPI(greetingPayload);\n    },\n\n    setPersistentMenu() {\n        let menuPayload = this.getPersistentMenu();\n        facebookAPI.callMessengerProfileAPI(menuPayload);\n    },\n\n    setWhitelistedDomains() {\n        let domainPayload = this.getWhitelistedDomains();\n        facebookAPI.callMessengerProfileAPI(domainPayload);\n    }\n\n};\n","'use strict';\nimport moment from 'moment';\nimport { struct } from 'pb-util';\nimport send from './send';\nimport utils from '../utils';\nimport mysql from '../config/mysql';\nimport dialogflowAPI from '../services/dialogflow.service';\nimport facebookAPI from '../services/facebook.service';\nimport calendarAPI from '../services/calendar.service';\nimport calendarModel from '../models/calendar.model';\nimport userModel from '../models/user.model';\n\n/**\n * Process message type card\n * @param {Object} messages\n * @param {Number} sender\n */\nconst handleCardMessages = (messages, sender) => {\n    let elements = [];\n    for (var m = 0; m < messages.length; m += 1) {\n        let message = messages[m];\n\n        let buttons = [];\n        for (var b = 0; b < message.card.buttons.length; b += 1) {\n            let isLink = message.card.buttons[b].postback.substring(0, 4) === 'http';\n            let button;\n            if (isLink) {\n                button = {\n                    type: 'web_url',\n                    title: message.card.buttons[b].text,\n                    url: message.card.buttons[b].postback\n                };\n            } else {\n                button = {\n                    type: 'postback',\n                    title: message.card.buttons[b].text,\n                    payload: message.card.buttons[b].postback\n                };\n            }\n            buttons.push(button);\n        }\n\n        let element = {\n            title: message.card.title,\n            image_url: message.card.imageUri,\n            subtitle: message.card.subtitle,\n            buttons: buttons\n        };\n        elements.push(element);\n    }\n    send.sendGenericMessage(sender, elements);\n};\n\n/**\n * Process messages\n * @param {Object} messages\n * @param {Number} sender\n */\nconst handleMessages = (messages, sender) => {\n    let timeoutInterval = 1100;\n    let previousType;\n    let cardTypes = [];\n    let timeout = 0;\n    for (var i = 0; i < messages.length; i += 1) {\n        if (\n            previousType == 'card' &&\n      (messages[i].message != 'card' || i == messages.length - 1)\n        ) {\n            timeout = (i - 1) * timeoutInterval;\n            setTimeout(handleCardMessages.bind(null, cardTypes, sender), timeout);\n            cardTypes = [];\n            timeout = i * timeoutInterval;\n            setTimeout(handleMessage.bind(null, messages[i], sender), timeout);\n        } else if (messages[i].message == 'card' && i == messages.length - 1) {\n            cardTypes.push(messages[i]);\n            timeout = (i - 1) * timeoutInterval;\n            setTimeout(handleCardMessages.bind(null, cardTypes, sender), timeout);\n            cardTypes = [];\n        } else if (messages[i].message == 'card') {\n            cardTypes.push(messages[i]);\n        } else {\n            timeout = i * timeoutInterval;\n            setTimeout(handleMessage.bind(null, messages[i], sender), timeout);\n        }\n        previousType = messages[i].message;\n    }\n};\n\n\n/**\n * Process single message\n * @param {Object} message\n * @param {Number} sender\n */\n\n\nconst handleMsgObj = {\n    'text': (message, sender) => {\n        message.text.text.forEach(text => {\n            if (text !== '') {\n                send.sendTextMessage(sender, text);\n            }\n        });\n    },\n    'quickReplies': (message, sender) => {\n        let replies = [];\n        message.quickReplies.quickReplies.forEach(text => {\n            let reply = {\n                content_type: 'text',\n                title: text,\n                payload: text\n            };\n            replies.push(reply);\n        });\n        return send.sendQuickReply(sender, message.quickReplies.title, replies);\n    },\n    'image': (message, sender) => {\n        send.sendImageMessage(sender, message.image.imageUri);\n    },\n    'payload': (message, sender) => {\n        const payload = struct.decode(message.payload);\n        let verifyPerson = null;\n    \n        if (payload.facebook.payload) {\n            verifyPerson = payload.facebook.person_true;\n        }\n    \n        let messageData = {\n            recipient: {\n                id: sender\n            },\n            message: payload.facebook,\n            verifyPerson\n        };\n        facebookAPI.sendCall(messageData, 0);\n    }\n};\n\nconst handleMessage = (message, sender) => {\n    handleMsgObj[message.message](message, sender);\n};\n\n/**\n * Process quick reply message\n * @param {*} senderID\n * @param {*} quickReply\n * @param {*} messageId\n */\nconst handleQuickReply = (senderID, quickReply, messageId) => {\n    var quickReplyPayload = quickReply.payload;\n    console.log(\n        '⚡️ [BOT CONSILIO] Quick reply for message %s with payload %s',\n        messageId,\n        quickReplyPayload\n    );\n\n    dialogflowAPI.sendTextToDialogFlow(senderID, quickReplyPayload);\n};\n\n/**\n * Process attachments\n * @param {*} messageAttachments\n * @param {Number} senderID\n */\nconst handleMessageAttachments = (messageAttachments, senderID) => {\n    send.sendTextMessage(senderID, 'Recebi o anexo. Muito obrigado.');\n};\n\n/**\n * Process Dialogflow response\n * @param {Number} sender\n * @param {Object} response\n */\nconst handleDialogFlowResponse = (sender, response) => {\n    let responseText = response.fulfillmentMessages.fulfillmentText;\n\n    let messages = response.fulfillmentMessages;\n    let action = response.action;\n    let contexts = response.outputContexts;\n    let parameters = response.parameters;\n\n    var delay = 1000;\n\n    if (utils.isDefined(action)) {\n        send.sendTypingOn(sender);\n        setTimeout(function() {\n            send.sendTypingOff(sender);\n            handleDialogFlowAction(sender, action, messages, contexts, parameters);\n        }, delay);\n    } else if (\n        utils.isDefined(messages) &&\n    ((messages.length == 1 && messages[0].type != 0) || messages.length > 1)\n    ) {\n        send.sendTypingOn(sender);\n        setTimeout(function() {\n            send.sendTypingOff(sender);\n            handleMessages(messages, sender);\n        }, delay);\n    } else if (responseText == '' && !utils.isDefined(action)) {\n        return false;\n    } else if (utils.isDefined(responseText)) {\n        send.sendTypingOn(sender);\n        setTimeout(function() {\n            send.sendTypingOff(sender);\n            send.sendTextMessage(sender, responseText);\n        }, delay);\n    }\n};\n\n/**\n * Process Dialogflow actions\n * @param {*} sender\n * @param {*} action\n * @param {*} messages\n * @param {*} contexts\n * @param {*} parameters\n */\nconst handleDFAObj = {\n    'input.welcome': async (sender, messages, contexts, parameters) => {\n        const user = utils.usersMap.get(sender);\n        const userDB = await mysql.execQuery(`SELECT * FROM leads WHERE senderID= '${sender}'`).catch(err => {\n            console.log('❌ ERRO: ', err);\n        });\n\n        const welcome = () => {\n            return new Promise(function(resolve) {\n                send.sendTypingOn(sender);\n                setTimeout(function() {\n                    resolve(send.sendTextMessage(sender, `Oi ${user.first_name}! 👋`));\n                }, 1000);\n            });\n        };\n        const about = () => {\n            return new Promise(function(resolve) {\n                send.sendTypingOn(sender);\n                setTimeout(function() {\n                    resolve(send.sendTextMessage(sender, 'Sou a Lary, a atendente virtual 🤖 da Clínica Dentalk!'));\n                }, 1000);\n            });\n        };\n        const copy = () => {\n            return new Promise(function(resolve) {\n                send.sendTypingOn(sender);\n                setTimeout(function() {\n                    resolve(send.sendTextMessage(sender, 'Aqui acreditamos que sorrisos renovados transformam vidas!'));\n                }, 1000);\n            });\n        };\n        const getPhone = () => {\n            return new Promise(function(resolve) {\n                send.sendTypingOn(sender);\n                setTimeout(function() {\n                    let replies = [\n                        {\n                            'content_type': 'user_phone_number',\n                            'title': 'user_phone_number',\n                            'payload': 'user_phone_number'\n                        }\n                    ];\n                    const text = 'Me confirme seu número de telefone:';\n                    resolve(send.sendQuickReply(sender, text, replies));\n                }, 1000);\n            });\n        };\n        const getEmail = () => {\n            return new Promise(function(resolve) {\n                send.sendTypingOn(sender);\n                setTimeout(function() {\n                    let replies = [\n                        {\n                            'content_type': 'user_email',\n                            'title': 'user_email',\n                            'payload': 'user_email'\n                        }\n                    ];\n                    const text = 'Ok! Antes de começarmos me confirme também seu e-mail:';\n                    resolve(send.sendQuickReply(sender, text, replies));\n                }, 1000);\n            });\n        };\n        const onboarding = (first) => {\n            return new Promise(function(resolve) {\n                send.sendTypingOn(sender);\n                setTimeout(function() {\n                    let replies = [\n                        {\n                            'content_type': 'text',\n                            'title': 'Agendar avaliação',\n                            'payload': 'Agendar avaliação'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Verificar avaliação',\n                            'payload': 'Verificar avaliação'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Cancelar avaliação',\n                            'payload': 'Cancelar avaliação'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Conhecer a clínica',\n                            'payload': 'Conhecer a clínica'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Tratamentos',\n                            'payload': 'Tratamentos'\n                        }\n                    ];\n                    if(first) {\n                        const text = 'Vamos começar o seu atendimento, selecione um dos botões abaixo. 👇';\n                        resolve(send.sendQuickReply(sender, text, replies));\n                    } else {\n                        const text = 'Que bom te ver por aqui novamente. No que posso te ajudar hoje?';\n                        resolve(send.sendQuickReply(sender, text, replies));\n                    }\n                }, 1000);\n            });\n        };\n\n        const restart = () => {\n            return new Promise(function(resolve) {\n                send.sendTypingOn(sender);\n                setTimeout(function() {\n                    let replies = [\n                        {\n                            'content_type': 'text',\n                            'title': 'Agendar avaliação',\n                            'payload': 'Agendar avaliação'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Verificar avaliação',\n                            'payload': 'Verificar avaliação'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Cancelar avaliação',\n                            'payload': 'Cancelar avaliação'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Conhecer a clínica',\n                            'payload': 'Conhecer a clínica'\n                        },\n                        {\n                            'content_type': 'text',\n                            'title': 'Tratamentos',\n                            'payload': 'Tratamentos'\n                        }\n                    ];\n                    \n                    const text = 'Quer falar sobre outro assunto? 🤓 \\nTenho algumas sugestões aqui para você:';\n                    resolve(send.sendQuickReply(sender, text, replies));\n                    \n                }, 1000);\n            });\n        };\n\n        if (userDB && userDB.phone && userDB.email) {\n\n            welcome().then(() => {\n                return setTimeout(function() {\n                    send.sendTypingOn(sender);\n                    onboarding();\n                }, 1000);\n            });\n\n        } else {\n\n            const [phone, email] = [parameters.fields.phone.stringValue, parameters.fields.email.stringValue];\n            let missingSlots = [];\n            if (!phone) { missingSlots.push('telefone'); }\n            if (!email) { missingSlots.push('e-mail'); }\n\n            if (missingSlots.length === 1){\n                if (!phone && email) {\n                    return getPhone();\n                } else if (!email && phone) {\n                    return getEmail();\n                }\n            } \n            else if (missingSlots.length === 2){\n                welcome().then(() => {\n                    return about();\n                }).then(() => {\n                    return copy();\n                }).then(() => {\n                    return getPhone();\n                });\n            } else {\n                if (phone && email) {\n                    mysql.execQuery(`UPDATE leads SET phone = '${phone}' WHERE senderID = '${sender}'`)\n                        .catch(err => {\n                            console.log('❌ ERRO: ', err);\n                        });\n                    mysql.execQuery(`UPDATE leads SET email = '${email}' WHERE senderID = '${sender}'`)\n                        .catch(err => {\n                            console.log('❌ ERRO: ', err);\n                        });\n                }\n                return setTimeout(function() {\n                    send.sendTypingOn(sender);\n                    onboarding(true);\n                }, 1000);\n            }\n        }\n    \n    },\n    'input.schedule': async (sender, messages, contexts, parameters) => {\n        const userDB = await userModel.getUserDB(sender);\n        const event = await calendarModel.getEvent(sender);\n\n        send.sendTypingOn(sender);\n\n        if (event && event.status == 'confirmed') {\n\n            const text = `Você já tem uma avaliação marcada 📆 ${moment(event.start).locale('pt-br').format('LLLL')}.`;\n            send.sendTextMessage(sender, text);\n\n            setTimeout(function() {\n                let text = 'Deseja reagendar? 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Reagendar agora',\n                        'payload': 'Reagendar agora'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 1000);\n\n        } else {\n\n            const [date, time] = [parameters.fields.date.stringValue, parameters.fields.time.stringValue];\n\n            let missingSlots = [];\n            if (!date) { missingSlots.push('data'); }\n            if (!time) { missingSlots.push('horário'); }\n\n            if (missingSlots.length === 1){\n                const dateTimeStart = new Date(Date.parse(date.split('T')[0] + 'T' + date.split('T')[1].split('-')[0] + '-03:00'));\n\n                calendarAPI.slotsFromEvents(dateTimeStart).then((resTime) => {\n                    let replies = [];\n                    resTime.forEach(function(time) {\n                        const hour = moment(time).format('HH:mm');\n                        replies.push({\n                            'content_type': 'text',\n                            'title': hour,\n                            'payload': hour\n                        });\n                    });\n                    let text = 'Agora, selecione o melhor horário dentre os disponíveis para a sua avaliação:';\n                    send.sendQuickReply(sender, text, replies);\n                });\n\n            } \n            else if (missingSlots.length === 2){\n                const today = moment().format();\n                const dateTimeStart = new Date(Date.parse(today.split('T')[0] + 'T' + today.split('T')[1].split('-')[0] + '-03:00'));\n                const dateTimeEnd = new Date(moment(dateTimeStart).add(7, 'days'));\n\n                calendarAPI.daysFromSlots(dateTimeStart, dateTimeEnd).then((resTime) => {\n                    let days = [];\n                    let daysRefine = [];\n                    resTime.forEach(function(time) {\n                        moment.locale('pt-BR');\n                        const day = moment(time.startDate).format('DD');\n                        const month = moment(time.startDate).format('MM');\n                        const weekDay = moment(time.startDate).format('dddd');\n\n                        days.push({\n                            day: day,\n                            month: month,\n                            weekDay: weekDay\n                        });\n                        daysRefine = days.filter(function (a) {\n                            return !this[JSON.stringify(a)] && (this[JSON.stringify(a)] = true);\n                        }, Object.create(null));\n                    });\n                    let replies = [];\n                    daysRefine.forEach(function(day) {\n                        replies.push({\n                            'content_type': 'text',\n                            'title': `${day.weekDay.substring(0,3)} - ${day.day}/${day.month}`,\n                            'payload': `${day.weekDay.substring(0,3)} - ${day.day}/${day.month}`\n                        });\n                    });\n                    let text = 'Que dia fica bom para você fazer sua avaliação?';\n                    send.sendQuickReply(sender, text, replies);\n                });\n            } else {\n                handleMessages(messages, sender);\n                send.sendTypingOn(sender);\n                if (parameters.fields.date.stringValue && parameters.fields.time.stringValue) {\n                    const date = parameters.fields.date.stringValue;\n                    const time = parameters.fields.time.stringValue;\n                    const dateTimeStart = new Date(Date.parse(date.split('T')[0] + 'T' + time.split('T')[1].split('-')[0] + '-03:00'));\n                    const dateTimeEnd = new Date(new Date(dateTimeStart).setHours(dateTimeStart.getHours() + 1));\n                    const appointmentTimeString = moment(dateTimeStart).locale('pt-br').format('LLLL');\n             \n                    calendarAPI.createCalendarEvent(dateTimeStart, dateTimeEnd, userDB).then(async (res) => {\n\n                        const event = res.data;\n                        const eventID = await utils.getEventID(event);\n\n                        mysql.execQuery(`INSERT INTO calendar_events (eventID, senderID, status, link, summary, description, start, end) VALUES ('${eventID}', '${sender}', '${event.status}', '${event.htmlLink}', '${event.summary}', '${event.description}', '${moment(event.start.dateTime).format('YYYY-MM-DD HH:mm:ss')}', '${moment(event.end.dateTime).format('YYYY-MM-DD HH:mm:ss')}')`).catch(err => {\n                            console.log('❌ ERRO: ', err);\n                        });\n                    \n                        send.sendTypingOn(sender);\n                        setTimeout(function() {\n                            const text = `Tudo certo ${userDB.first_name}! Agendei aqui para você. 📝 \\nTe aguardamos aqui 📆 ${appointmentTimeString}.`;\n                            send.sendTextMessage(sender, text);\n                        }, 1000);\n                        setTimeout(function() {\n                            let buttons = [\n                                {\n                                    type:'web_url',\n                                    url:'http://bit.ly/humbertoconsilio',\n                                    title:'Chamar no WhatsApp'\n                                },\n                                {\n                                    type:'phone_number',\n                                    title:'Ligar agora',\n                                    payload:'+5562983465454',\n                                },\n                                {\n                                    type:'postback',\n                                    title:'Falar com humano',\n                                    payload:'Falar com humano'\n                                }\n                            ];\n        \n                            send.sendButtonMessage(sender, 'Caso tenha ficado alguma dúvida, fique à vontade de conversar com a gente!', buttons);\n                        }, 4000);\n                    }).catch((erro) => {\n                        console.log('ERRO', erro);\n                        const text = `Opps o horário ${appointmentTimeString}, não está disponível. Vamos tentar outro?`;\n                        send.sendTextMessage(sender, text);\n                    }); \n                }\n            }\n        }\n    },\n    'input.schedule.verify': async (sender) => {\n        send.sendTypingOn(sender);\n        const event = await calendarModel.getEvent(sender);\n        \n        if (event && event.status == 'confirmed') {\n                     \n            const text = `Encontrei! Sou rápida, não é mesmo? 😏 \\nExiste um agendamento para 📆 ${moment(event.start).locale('pt-br').format('LLLL')}.`;\n            send.sendTextMessage(sender, text);\n    \n            setTimeout(function() {\n                let text = 'Deseja reagendar ou cancelar? 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Reagendar agora',\n                        'payload': 'Reagendar agora'\n                    },\n                    {\n                        'content_type': 'text',\n                        'title': 'Cancelar agora',\n                        'payload': 'Cancelar agora'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 1000);\n        } else {\n            const text = 'Infelizmente não encontrei o seu agendamento. 😰';\n            send.sendTextMessage(sender, text);\n\n            setTimeout(function() {\n                let text = 'Mas, calma. Você pode agendar a sua avaliação agora! 😄 \\n\\nSelecione para agendar. 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Agendar agora',\n                        'payload': 'Agendar agora'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 1000);   \n        }\n    },\n    'input.schedule.update': async (sender) => {\n        send.sendTypingOn(sender);\n        const event = await calendarModel.getEvent(sender);\n\n        if (event && event.status == 'confirmed') {\n            \n            const text = `Ótimo! Estava marcado dia 📆 ${moment(event.start).locale('pt-br').format('LLLL')}.`;\n            send.sendTextMessage(sender, text);\n\n            setTimeout(function() {\n                let text = 'Posso continuar o reagedamento? 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Sim',\n                        'payload': 'Sim'\n                    },\n                    {\n                        'content_type': 'text',\n                        'title': 'Não',\n                        'payload': 'Não'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 1000);\n        } else {\n            const text = 'Infelizmente não encontrei o seu agendamento. 😰';\n            send.sendTextMessage(sender, text);\n\n            setTimeout(function() {\n                let text = 'Mas, calma. Você pode agendar a sua avaliação agora! 😄 \\n\\nSelecione para agendar. 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Agendar agora',\n                        'payload': 'Agendar agora'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 1000);\n        }\n\n    },\n    'input.schedule.update-yes': async (sender, messages, contexts, parameters) => {\n        const userDB = await userModel.getUserDB(sender);\n        const event = await calendarModel.getEvent(sender);\n        \n        send.sendTypingOn(sender);\n        handleMessages(messages, sender);\n        if (parameters.fields.date.stringValue && parameters.fields.time.stringValue) {\n            const date = parameters.fields.date.stringValue;\n            const time = parameters.fields.time.stringValue;\n            const dateTimeStart = new Date(Date.parse(date.split('T')[0] + 'T' + time.split('T')[1].split('-')[0] + '-03:00'));\n            const dateTimeEnd = new Date(new Date(dateTimeStart).setHours(dateTimeStart.getHours() + 1));\n            const appointmentTimeString = moment(dateTimeStart).locale('pt-br').format('LLLL');\n        \n            calendarAPI.updateCalendarEvent(dateTimeStart, dateTimeEnd, event.eventID).then((res) => {\n\n                const event = res.data;\n                mysql.execQuery(`UPDATE calendar_events SET start = '${moment(event.start.dateTime).format('YYYY-MM-DD HH:mm:ss')}', end = '${moment(event.end.dateTime).format('YYYY-MM-DD HH:mm:ss')}' WHERE senderID='${sender}'`).catch(err => {\n                    console.log('❌ ERRO: ', err);\n                });\n\n                setTimeout(function() {\n                    const text = `${userDB.first_name}, reagendei aqui! ✌ \\nTe aguardamos aqui 📆 ${appointmentTimeString}.`;\n                    send.sendTextMessage(sender, text);\n                }, 1000);\n                setTimeout(function() {\n                    let buttons = [\n                        {\n                            type:'web_url',\n                            url:'http://bit.ly/humbertoconsilio',\n                            title:'Chamar no WhatsApp'\n                        },\n                        {\n                            type:'phone_number',\n                            title:'Ligar agora',\n                            payload:'+5562983465454',\n                        },\n                        {\n                            type:'postback',\n                            title:'Falar com humano',\n                            payload:'Falar com humano'\n                        }\n                    ];\n    \n                    send.sendButtonMessage(sender, 'Caso tenha ficado alguma dúvida, fique à vontade de conversar com a gente!', buttons);\n                }, 4000);\n               \n            }).catch((erro) => {\n                console.log('ERRO', erro);\n                const text = `Opps o horário ${appointmentTimeString}, não está disponível. Vamos tentar outro?`;\n                send.sendTextMessage(sender, text);\n            }); \n        }\n    },\n    'input.schedule.cancel': async (sender) => {\n        send.sendTypingOn(sender);\n\n        const event = await calendarModel.getEvent(sender);\n\n        if (event && event.status == 'confirmed') {\n            \n            const text = 'Que pena! 😢 \\nA avaliação é o primeiro passo para a transformação do seu sorriso ou dar aquele up! na autoestima.';\n            send.sendTextMessage(sender, text);\n\n            setTimeout(function() {\n                let text = 'Deseja mesmo cancelar a sua avaliação? Lembre-se que você pode reagendar. 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Sim',\n                        'payload': 'Sim'\n                    },\n                    {\n                        'content_type': 'text',\n                        'title': 'Não',\n                        'payload': 'Não'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 1000);\n        } else {\n            const text = 'Não encontrei o seu agendamento 🤔';\n            send.sendTextMessage(sender, text);\n            \n            setTimeout(function() {\n                let text = 'Caso você queira ver sobre outro assunto. \\n\\nÉ só selecionar o botão 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Agendar avaliação',\n                        'payload': 'Agendar avaliação'\n                    },\n                    {\n                        'content_type': 'text',\n                        'title': 'Tratamentos',\n                        'payload': 'Tratamentos'\n                    },\n                    {\n                        'content_type': 'text',\n                        'title': 'Horário de funcionamento',\n                        'payload': 'Horário de funcionamento'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 2000);\n        }\n    },\n    'input.schedule.cancel-yes': async (sender) => {\n        send.sendTypingOn(sender);\n        const userDB = await userModel.getUserDB(sender);\n        const event = await calendarModel.getEvent(sender);\n        console.log(event);\n        await calendarAPI.deleteCalendarEvent(event.eventID).then(async () => {\n            send.sendTypingOn(sender);\n            await calendarModel.cancelEvent(sender);\n\n            setTimeout(function() {\n                const text = `${userDB.first_name}, tudo pronto! \\nCancelei sua avaliação.`;\n                send.sendTextMessage(sender, text);\n            }, 1000);\n            \n            setTimeout(function() {\n                let text = 'Caso você queira ver sobre outro assunto. \\n\\nÉ só selecionar o botão 👇';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Agendar avaliação',\n                        'payload': 'Agendar avaliação'\n                    },\n                    {\n                        'content_type': 'text',\n                        'title': 'Tratamentos',\n                        'payload': 'Tratamentos'\n                    },\n                    {\n                        'content_type': 'text',\n                        'title': 'Horário de funcionamento',\n                        'payload': 'Horário de funcionamento'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 2000);\n           \n        }).catch((erro) => {\n            console.log('ERRO', erro);\n            const text = 'Ops, não consegui acessar a agenda agora, tente novamente mais tarde. 😓 ';\n            send.sendTextMessage(sender, text);\n        }); \n    },\n    'input.institutional': async (sender) => {\n        send.sendTypingOn(sender);\n        const event = await calendarModel.getEvent(sender);\n\n        setTimeout(function() {\n            const text = 'Ficamos felizes de você querer nos conhecer melhor! 💗 \\n\\nVamos aqui conta um pouco sobre a nossa clínica. Nossa Clínica foi fundada nos mais sólidos princípios éticos e profissionais. Possuímos uma equipe de profissionais especializada e pronta para oferecer o que há de mais avançado em tratamentos odontológicos e estética facial.';\n            send.sendTextMessage(sender, text);\n        }, 1000);\n\n        if (event && event.status == 'confirmed') {\n            setTimeout(function() {\n                const text = 'É meio complicado demonstrarmos tudo o que somos capazes por aqui.\\nMas, a sua consulta de avaliação já está chegando e logo você nos conhecerá melhor. 😍 \\n\\nCaso tenha ficado alguma dúvida, fique à vontade de conversar com a gente no WhatsApp!';\n                send.sendTextMessage(sender, text);\n            }, 2000);\n            setTimeout(function() {\n                let buttons = [\n                    {\n                        type:'web_url',\n                        url:'http://bit.ly/humbertoconsilio',\n                        title:'Chamar no WhatsApp'\n                    }\n                ];\n\n                send.sendButtonMessage(sender, 'Caso tenha ficado alguma dúvida, fique à vontade de conversar com a gente!', buttons);\n            }, 2000);\n        } else {\n            send.sendTypingOn(sender);\n            setTimeout(function() {\n                const text = 'É complicado demonstrarmos tudo o que somos capazes por aqui.';\n                send.sendTextMessage(sender, text);\n            }, 2000);\n            setTimeout(function() {\n                let text = 'Agende uma avaliação, será um prazer te receber 😍';\n                let replies = [\n                    {\n                        'content_type': 'text',\n                        'title': 'Agendar agora',\n                        'payload': 'Agendar agora'\n                    }\n                ];\n                send.sendQuickReply(sender, text, replies);\n            }, 2000);\n        }\n    },\n    'input.treatments': (sender) => {\n        send.sendTypingOn(sender);\n        setTimeout(function() {\n            const text = 'Entendi! Veja alguns tratamentos/procedimentos que realizamos aqui na clínica e saiba mais sobre cada um deles. É só escolher 😉';\n            send.sendTextMessage(sender, text);\n        }, 1000);\n        setTimeout(function() {\n            let elements = [\n                {\n                    title:'Invisalign',\n                    image_url:'https://afetoodontologia.com.br/wp-content/uploads/2019/10/shutterstock-1006765645.png',\n                    subtitle:'O Invisalign são “alinhadores invisíveis”. Alternativa para quem não quer usar os aparelhos tradicionais',\n                    default_action: {\n                        type: 'web_url',\n                        url: 'https://consilio.com.br/',\n                    },\n                    buttons: [{\n                        type: 'postback',\n                        title: 'Agendar consulta',\n                        payload: 'SCHEDULE_APPOINTMENT',\n                    }]      \n                },\n                {\n                    title:'Harmonização facial',\n                    image_url:'https://afetoodontologia.com.br/wp-content/uploads/2019/10/harmoniza%C3%A7%C3%A3o-site-768x536.png',\n                    subtitle:'Novo conceito da estética facial e rejunevescimento que integra a naturalidade à beleza da face',\n                    default_action: {\n                        type: 'web_url',\n                        url: 'https://consilio.com.br/',\n                    },\n                    buttons: [{\n                        type: 'postback',\n                        title: 'Agendar consulta',\n                        payload: 'SCHEDULE_APPOINTMENT',\n                    }]      \n                },\n                {\n                    title:'Ortodontia',\n                    image_url:'https://afetoodontologia.com.br/wp-content/uploads/2019/09/ortodontia.jpg',\n                    subtitle:'Dentes alinhados não ajudam apenas o seu sorriso, mas também a saúde do seu organismo',\n                    default_action: {\n                        type: 'web_url',\n                        url: 'https://consilio.com.br/',\n                    },\n                    buttons: [{\n                        type: 'postback',\n                        title: 'Agendar consulta',\n                        payload: 'SCHEDULE_APPOINTMENT',\n                    }]      \n                },\n                {\n                    title:'Implantes Dentários',\n                    image_url:'https://afetoodontologia.com.br/wp-content/uploads/2020/04/implantes-dentarios-afeto.jpg',\n                    subtitle:'O tratamento por meio do Implante trata-se de um pino inserido no maxilar ou mandíbula através de uma cirurgia. ',\n                    default_action: {\n                        type: 'web_url',\n                        url: 'https://consilio.com.br/',\n                    },\n                    buttons: [{\n                        type: 'postback',\n                        title: 'Agendar consulta',\n                        payload: 'SCHEDULE_APPOINTMENT',\n                    }]      \n                },\n                {\n                    title:'Lentes de Contato',\n                    image_url:'https://afetoodontologia.com.br/wp-content/uploads/2020/03/image.png',\n                    subtitle:'As Lentes de Contato Dentais são trabalhos estéticos que encobrem a frente do dente.',\n                    default_action: {\n                        type: 'web_url',\n                        url: 'https://consilio.com.br/',\n                    },\n                    buttons: [{\n                        type: 'postback',\n                        title: 'Agendar consulta',\n                        payload: 'SCHEDULE_APPOINTMENT',\n                    }]      \n                }\n            ];\n            send.sendGenericMessage(sender, elements);\n        }, 2000);\n    },\n    'input.values': (sender) => {\n        send.sendTypingOn(sender);\n        setTimeout(function() {\n            const text = 'Para te passarmos um valor, precisamos primeiramente fazer uma avaliação sem compromisso. O valor costuma ser diferente de paciente para paciente.';\n            send.sendTextMessage(sender, text);\n        }, 1000);\n        setTimeout(function() {\n            let text = 'Mas, fique tranquilo! Você pode agendar a sua avaliação agora. Clique abaixo. 😬';\n            let replies = [\n                {\n                    'content_type': 'text',\n                    'title': 'Agendar agora',\n                    'payload': 'Agendar agora'\n                }\n            ];\n            send.sendQuickReply(sender, text, replies);\n        }, 2000);\n    },\n    'talk.human': (sender) => {\n        send.sendTypingOn(sender);\n        facebookAPI.sendPassThread(sender);\n    },\n    'input.unknown': (sender, messages) => {\n        send.sendTypingOn(sender);\n        handleMessages(messages, sender);\n        setTimeout(function() {\n            let text = 'Opps, talvez eu não tenha aprendido o suficiente. 😔 \\n\\nPodemos tentar de novo, ou se preferir falar com um dos nossos humanos disponíveis. 💜';\n            let replies = [\n                {\n                    'content_type': 'text',\n                    'title': 'Falar com humano',\n                    'payload': 'Falar com humano'\n                }\n            ];\n            send.sendQuickReply(sender, text, replies);\n        }, 1000);\n    },\n    'default': (sender, messages) => {\n        send.sendTypingOn(sender);\n        handleMessages(messages, sender);\n    }\n};\nconst handleDialogFlowAction = (sender, action, messages, contexts, parameters) => {\n    return (handleDFAObj[action] ? handleDFAObj[action] : handleDFAObj['default'])(sender, messages, contexts, parameters);\n};\n\n/**\n * Just logging message echoes to console\n * @param {Number} messageId\n * @param {Number} appId\n * @param {Object} metadata\n */\nconst handleEcho = (messageId, appId, metadata) => {\n    console.log(\n        '❌ [BOT CONSILIO] Received echo for message %s and app %d with metadata %s',\n        messageId,\n        appId,\n        metadata\n    );\n};\n\n/**\n * Received message\n * @param {*} event\n */\nconst receivedMessage = event => {\n    var senderID = event.sender.id;\n    var recipientID = event.recipient.id;\n    var timeOfMessage = event.timestamp;\n    var message = event.message;\n\n    utils.setSessionandUser(senderID);\n\n    console.log(\n        '⚡️ [BOT CONSILIO] Received message for user %d and page %d at %d with message:',\n        senderID,\n        recipientID,\n        timeOfMessage\n    );\n\n    var isEcho = message.is_echo;\n    var messageId = message.mid;\n    var appId = message.FB_APP_ID;\n    var metadata = message.metadata;\n\n    // You may get a text or attachment but not both\n    var messageText = message.text;\n    var messageAttachments = message.attachments;\n    var quickReply = message.quick_reply;\n\n    if (isEcho) {\n        handleEcho(messageId, appId, metadata);\n        return;\n    } else if (quickReply) {\n        handleQuickReply(senderID, quickReply, messageId);\n        return;\n    }\n\n    if (messageText) {\n        dialogflowAPI.sendTextToDialogFlow(senderID, messageText);\n    } else if (messageAttachments) {\n        handleMessageAttachments(messageAttachments, senderID);\n    }\n};\n\n/**\n * Received post back\n * @param {*} event\n */\n\nconst receivedPbObj = {\n    'get_started': async (senderID, payload) => {\n        await utils.setSessionandUser(senderID);\n        dialogflowAPI.sendTextToDialogFlow(senderID, payload);\n    },\n    'VIEW_SITE': (senderID, payload) => {\n        send.sendTextMessage(senderID, payload);\n    },\n    'SCHEDULE_APPOINTMENT': (senderID) => {\n        dialogflowAPI.sendEventToDialogFlow(senderID, 'schedule');\n    },\n    'DEFAULT': (senderID, payload) => {\n        send.sendTextMessage(senderID, payload);\n    }\n};\nconst receivedPostback = event => {\n    var senderID = event.sender.id;\n    var recipientID = event.recipient.id;\n    var timeOfPostback = event.timestamp;\n\n    var payload = event.postback.payload;\n\n    console.log(\n        '⚡️ [BOT CONSILIO] Received postback for user %d and page %d with payload \\'%s\\' ' +\n      'at %d',\n        senderID,\n        recipientID,\n        payload,\n        timeOfPostback\n    );\n\n    return (receivedPbObj[payload] || receivedPbObj['DEFAULT'])(senderID, payload);\n};\n\n/**\n * Received notification message read\n * @param {*} event\n */\nconst receivedMessageRead = event => {\n    // var senderID = event.sender.id;\n    // var recipientID = event.recipient.id;\n\n    var watermark = event.read.watermark;\n    var sequenceNumber = event.read.seq;\n\n    console.log(\n        '⚡️ [BOT CONSILIO] Received message read event for watermark %d and sequence ' +\n      'number %d',\n        watermark,\n        sequenceNumber\n    );\n};\n\n/**\n * Received notification authentication\n * @param {*} event\n */\nconst receivedAuthentication = event => {\n    var senderID = event.sender.id;\n    var recipientID = event.recipient.id;\n    var timeOfAuth = event.timestamp;\n\n    var passThroughParam = event.optin.ref;\n\n    console.log(\n        '⚡️ [BOT CONSILIO] Received authentication for user %d and page %d with pass ' +\n      'through param \\'%s\\' at %d',\n        senderID,\n        recipientID,\n        passThroughParam,\n        timeOfAuth\n    );\n    send.sendTextMessage(senderID, 'Autenticação realizada com sucesso!');\n};\n\n/**\n * Received account link\n * @param {*} event\n */\nconst receivedAccountLink = event => {\n    var senderID = event.sender.id;\n    // var recipientID = event.recipient.id;\n\n    var status = event.account_linking.status;\n    var authCode = event.account_linking.authorization_code;\n\n    console.log(\n        '⚡️ [BOT CONSILIO] Received account link event with for user %d with status %s ' +\n      'and auth code %s ',\n        senderID,\n        status,\n        authCode\n    );\n};\n\n/**\n * Received devivery confirmation\n * @param {*} event\n */\nconst receivedDeliveryConfirmation = event => {\n    // var senderID = event.sender.id;\n    // var recipientID = event.recipient.id;\n    var delivery = event.delivery;\n    var messageIDs = delivery.mids;\n    var watermark = delivery.watermark;\n    // var sequenceNumber = delivery.seq;\n\n    if (messageIDs) {\n        messageIDs.forEach(function(messageID) {\n            console.log(\n                '⚡️ [BOT CONSILIO] Received delivery confirmation for message ID: %s',\n                messageID\n            );\n        });\n    }\n    console.log(\n        '⚡️ [BOT CONSILIO] All message before %d were delivered.',\n        watermark\n    );\n};\n\nexport default {\n    handleCardMessages,\n    handleMessages,\n    handleMessage,\n    handleQuickReply,\n    handleMessageAttachments,\n    handleDialogFlowResponse,\n    handleDialogFlowAction,\n    handleEcho,\n    receivedMessage,\n    receivedPostback,\n    receivedMessageRead,\n    receivedAuthentication,\n    receivedAccountLink,\n    receivedDeliveryConfirmation\n};\n","'use strict';\nimport facebookAPI from '../services/facebook.service';\nimport utils from '../utils';\nimport config from '../config/variables';\n\n/**\n * Send action typing on using the Service API\n * @param {Number} recipientId\n */\nconst sendTypingOn = recipientId => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        sender_action: 'typing_on'\n    };\n\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/**\n * Send action typing off using the Service API\n * @param {Number} recipientId\n */\nconst sendTypingOff = recipientId => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        sender_action: 'typing_off'\n    };\n\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/**\n * Send type text message using the Service API\n * @param {Number} recipientId\n * @param {String} text\n */\nconst sendTextMessage = (recipientId, text) => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            text: text\n        }\n    };\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/**\n * Send text message with persona\n * @param {Number} recipientId\n * @param {String} text\n * @param {Number} persona_id\n */\nconst sendTextWithPersona = (recipientId, text, persona_id) => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            text: text,\n            persona_id: persona_id\n        }\n    };\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/*\n     * Send a Gif using the Send API.\n     *\n     */\nconst sendGifMessage = (recipientId, GifName) => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            attachment: {\n                type: 'image',\n                payload: {\n                    url: config.APP_URL + GifName\n                }\n            }\n        }\n    };\n\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/*\n     * Send a image using the Send API.\n     *\n     */\nconst sendImageMessage = (recipientId, imageName) => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            attachment: {\n                type: 'image',\n                payload: {\n                    url: config.APP_URL + imageName\n                }\n            }\n        }\n    };\n\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/**\n * Send type quick reply message using the Service API.\n * @param {Number} recipientId\n * @param {String} text\n */\nconst sendQuickReply = (recipientId, text, replies, metadata) => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            text: text,\n            metadata: utils.isDefined(metadata) ? metadata : '',\n            quick_replies: replies\n        }\n    };\n\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/*\n     * Send a button message using the Send API.\n     *\n     */\nconst sendButtonMessage = (recipientId, text, buttons) => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            attachment: {\n                type: 'template',\n                payload: {\n                    template_type: 'button',\n                    text: text,\n                    buttons: buttons\n                }\n            }\n        }\n    };\n\n    facebookAPI.sendCall(messageData, 0);\n};\n\n/**\n * Send type template generic message using the Service API.\n * @param {Number} recipientId\n * @param {Object} elements\n */\nconst sendGenericMessage = (recipientId, elements) => {\n    var messageData = {\n        recipient: {\n            id: recipientId\n        },\n        message: {\n            attachment: {\n                type: 'template',\n                payload: {\n                    template_type: 'generic',\n                    elements: elements\n                }\n            }\n        }\n    };\n    facebookAPI.sendCall(messageData, 0);\n};\n\nexport default {\n    sendTypingOn,\n    sendTypingOff,\n    sendTextMessage,\n    sendTextWithPersona,\n    sendQuickReply,\n    sendButtonMessage,\n    sendGifMessage,\n    sendImageMessage,\n    sendGenericMessage\n};\n","import config from '../config/variables';\nimport utils from '../utils';\nimport receive from './receive';\nimport profile from './profile';\nimport facebookAPI from '../services/facebook.service';\n\nprocess.env.DEBUG = 'dialogflow:debug'; // enables lib debugging statements\n\nconst messageHandler = async (req, res) => {\n    try {\n        let body = req.body;\n\n        if (body.object === 'page') {\n            // var pageID = pageEntry.id;\n            // var timeOfEvent = pageEntry.time;\n\n            body.entry.forEach(function(pageEntry) {\n\n                let hookEvent = pageEntry.messaging[0];\n                let senderPsid = hookEvent.sender.id;\n\n                utils.setSessionandUser(senderPsid);\n\n                if (pageEntry.standby) {\n                    pageEntry.standby.forEach(event => {\n                        const psid = event.sender.id;\n                        const message = event.message;\n                        console.log('message from: ', psid);\n                        console.log('message to inbox: ', message);\n                    });\n                }\n\n                if (pageEntry.messaging) {\n                    pageEntry.messaging.forEach(function(messagingEvent) {\n                        if (messagingEvent.optin) {\n                            receive.receivedAuthentication(messagingEvent);\n                        } else if (messagingEvent.message) {\n                            receive.receivedMessage(messagingEvent);\n                        } else if (messagingEvent.delivery) {\n                            receive.receivedDeliveryConfirmation(messagingEvent);\n                        } else if (messagingEvent.postback) {\n                            receive.receivedPostback(messagingEvent);\n                        } else if (messagingEvent.read) {\n                            receive.receivedMessageRead(messagingEvent);\n                        } else if (messagingEvent.account_linking) {\n                            receive.receivedAccountLink(messagingEvent);\n                        } else if (messagingEvent.pass_thread_control) {\n                            receive.receivedMessage(messagingEvent.pass_thread_control.metadata);\n                        } else {\n                            console.log(\n                                '❌ [BOT CONSILIO] Webhook received unknown messaging. Event: ',\n                                messagingEvent\n                            );\n                        }\n                    });\n                }\n            });\n\n            res.status(200).send('⚡️ [BOT CONSILIO] Event receiving.');\n        } \n\n    } catch (error) {\n        console.log('❌ [BOT CONSILIO] Error in post webhook. ', error);\n    }\n};\n\nconst verifyWebhook = async (req, res) => {\n    try {\n        const mode = req.query['hub.mode'];\n        const challenge = req.query['hub.challenge'];\n        const token = req.query['hub.verify_token'];\n\n        if (mode && token) {\n            if (mode === 'subscribe' && token === process.env.FB_VERIFY_TOKEN) {\n                console.log('⚡️ [BOT CONSILIO] Verify token passed.');\n                res.status(200).send(challenge);\n            } else {\n                console.log('❌ [BOT CONSILIO] Webhook is not verified.');\n                res.status(403);\n            }\n        }\n    } catch (error) {\n        console.log('❌ [BOT CONSILIO] Error in verify webhook ', error);\n    }\n};\n\nconst setProfile = async (req, res) => {\n    let token = req.query['verify_token'];\n    let mode = req.query['mode'];\n\n    if (!config.APP_URL.startsWith('https://')) {\n        res\n            .status(200)\n            .send('❌ [BOT CONSILIO] ERROR - Need a proper API_URL in the .env file');\n    }\n\n    if (mode && token) {\n        if (token === config.FB_VERIFY_TOKEN) {\n            if (mode == 'webhook' || mode == 'all') {\n                profile.setWebhook();\n                res.write(\n                    `<p>Set app ${config.FB_APP_ID} call to ${config.APP_URL}/webhook </p>`\n                );\n            }\n            if (mode == 'profile' || mode == 'all') {\n                profile.setThread();\n                res.write(`<p>Set Messenger Profile of Page ${config.FB_PAGE_ID}</p>`);\n            }\n            if (mode == 'nlp' || mode == 'all') {\n                facebookAPI.callNLPConfigsAPI();\n                res.write(`<p>Enable Built-in NLP for Page ${config.FB_PAGE_ID}</p>`);\n            }\n            if (mode == 'domains' || mode == 'all') {\n                profile.setWhitelistedDomains();\n                res.write(`<p>Whitelisting domains: ${config.whitelistedDomains}</p>`);\n            }\n            if (mode == 'private-reply') {\n                profile.setPageFeedWebhook();\n                res.write('<p>Set Page Feed Webhook for Private Replies.</p>');\n            }\n            res.status(200).end();\n        } else {\n            res.sendStatus(403);\n        }\n    } else {\n        res.sendStatus(404);\n    }\n};\n\nexport default { messageHandler, verifyWebhook, setProfile };","import mysql from 'mysql';\n\nconst connection = mysql.createConnection({\n    host     : '198.58.109.236',\n    port     : 3306,\n    user     : 'dentalk',\n    password : '!CCOKRQ1Ca1x',\n    database : 'dentalk'\n});\n\nfunction execQuery(sqlQry){\n    return new Promise((resolve, reject) => {\n        connection.query(sqlQry, function(error, results){\n            if(error) {\n                if (error.code == 'ER_DUP_ENTRY') {\n                    reject('Registro duplicado no banco de dados.');\n                } else {\n                    reject(JSON.parse(JSON.stringify(error)));\n                }\n            }\n            else {\n                const response = results[0];\n                resolve(response);\n            }\n        });\n    });\n}\n\n\n\nexport default {\n    execQuery\n};","'use strict';\n\nrequire('dotenv').config();\n\nconst ENV_VARS = [\n    'PORT',\n    'APP_URL',\n    'APP_EMAIL',\n    'SITE_URL',\n    'NAME_COMPANY',\n    'FB_PAGE_ID',\n    'FB_APP_ID',\n    'FB_PAGE_ACCESS_TOKEN',\n    'FB_VERIFY_TOKEN',\n    'GOOGLE_CLIENT_EMAIL',\n    'GOOGLE_PROJECT_ID',\n    'GOOGLE_LANGUAGE_CODE',\n    'GOOGLE_PRIVATE_KEY',\n    'GOOGLE_CALENDAR_ID'\n];\n\nexport default {\n    mPlatformDomain: 'https://graph.facebook.com',\n    mPlatformVersion: 'v3.2',\n\n    PORT: process.env.PORT || 3000,\n\n    APP_URL: process.env.APP_URL,\n    APP_EMAIL: process.env.APP_EMAIL,\n    SITE_URL: process.env.SITE_URL,\n    NAME_COMPANY: process.env.NAME_COMPANY,\n\n    FB_PAGE_ID: process.env.FB_PAGE_ID,\n    FB_APP_ID: process.env.FB_APP_ID,\n    FB_APP_SECRET: process.env.FB_APP_SECRET,\n    FB_PAGE_ACCESS_TOKEN: process.env.FB_PAGE_ACCESS_TOKEN,\n    FB_VERIFY_TOKEN: process.env.FB_VERIFY_TOKEN,\n\n    GOOGLE_CLIENT_EMAIL: process.env.GOOGLE_CLIENT_EMAIL,\n    GOOGLE_PROJECT_ID: process.env.GOOGLE_PROJECT_ID,\n    GOOGLE_LANGUAGE_CODE: process.env.GOOGLE_LANGUAGE_CODE,\n    GOOGLE_PRIVATE_KEY: process.env.GOOGLE_PRIVATE_KEY,\n    \n    GOOGLE_CALENDAR_ID: process.env.GOOGLE_CALENDAR_ID,\n    \n\n    get mPlatfom() {\n        return this.mPlatformDomain + '/' + this.mPlatformVersion;\n    },\n\n    get webhookUrl() {\n        return this.APP_URL + '/webhook';\n    },\n\n    get whitelistedDomains() {\n        return [this.APP_URL, this.SITE_URL];\n    },\n\n    checkEnv: function() {\n        ENV_VARS.forEach(function(key) {\n            if (!process.env[key]) {\n                console.log(\n                    '❌ [BOT CONSILIO] WARNING: Missing the environment variable ' + key\n                );\n            } else {\n                if (['APP_URL', 'SITE_URL'].includes(key)) {\n                    const url = process.env[key];\n                    if (!url.startsWith('https://')) {\n                        console.log(\n                            '❌ [BOT CONSILIO] WARNING: Your ' +\n                key +\n                ' does not begin with \"https://\"'\n                        );\n                    }\n                }\n            }\n        });\n    }\n};\n","import mysql from '../config/mysql';\n\nconst getEvent = async (sender) => {\n    return new Promise((resolve) => {\n        const query = mysql.execQuery(`SELECT * FROM calendar_events WHERE senderID='${sender}' ORDER BY id DESC LIMIT 1`).catch(err => {\n            console.log('❌ ERRO: ', err);\n        });\n        resolve(query);\n    });\n}; \nconst cancelEvent = async (sender) => {\n    return new Promise((resolve) => {\n        const query = mysql.execQuery(`UPDATE calendar_events SET status = 'canceled' WHERE senderID='${sender}'`).catch(err => {\n            console.log('❌ ERRO: ', err);\n        });\n        resolve(query);\n    });\n}; \n\nexport default {\n    getEvent,\n    cancelEvent\n};","import mysql from '../config/mysql';\n\nconst getUserDB = async (sender) => {\n    return new Promise((resolve) => {\n        const query = mysql.execQuery(`SELECT * FROM leads WHERE senderID= '${sender}'`).catch(err => {\n            console.log('❌ ERRO: ', err);\n        });\n        resolve(query);\n    });\n};\n\nexport default {\n    getUserDB\n};","'use strict';\nimport webhook from '../app/webhook';\n\nexport default function(app) {\n    app.route('/profile').get(webhook.setProfile);\n}","'use strict';\nimport webhook from '../app/webhook';\n\nexport default function(app) {\n    app.route('/webhook').get(webhook.verifyWebhook);\n    app.route('/webhook').post(webhook.messageHandler);\n}","'use strict';\nimport config from '../config/variables';\nimport moment from 'moment';\nimport { google } from 'googleapis';\n\nconst serviceAccountAuth = new google.auth.JWT({\n    email: config.GOOGLE_CLIENT_EMAIL,\n    key: config.GOOGLE_PRIVATE_KEY,\n    scopes: 'https://www.googleapis.com/auth/calendar'\n});\n\nconst calendar = google.calendar('v3');\n\nconst createCalendarEvent = (dateTimeStart, dateTimeEnd, userDB) => {\n    return new Promise((resolve, reject) => {\n        calendar.events.list({\n            auth: serviceAccountAuth,\n            calendarId: config.GOOGLE_CALENDAR_ID,\n            timeMin: dateTimeStart.toISOString(),\n            timeMax: dateTimeEnd.toISOString()\n        }, (err, calendarResponse) => {\n            if (err || calendarResponse.data.items.length > 0) {\n                reject(err || new Error('O horário solicitado entra em conflito com outro compromisso.'));\n            } else {\n                calendar.events.insert({ auth: serviceAccountAuth,\n                    calendarId: config.GOOGLE_CALENDAR_ID,\n                    resource: {\n                        summary: `Consulta de ${userDB.first_name}`,\n                        description: `Nome do paciente: ${userDB.first_name} ${userDB.last_name} \\nTelefone: ${userDB.phone} \\nE-mail: ${userDB.email} \\n\\nAgendamento realizado em: Facebook - ${moment().format('DD/MM/YYYY HH:mm')}`,\n                        start: {dateTime: dateTimeStart},\n                        end: {dateTime: dateTimeEnd}\n                    }\n                }, (err, event) => {\n                    err ? reject(err) : resolve(event);\n                }\n                );\n            }\n        });\n    });\n};\n\nconst updateCalendarEvent = (dateTimeStart, dateTimeEnd, eventID) => {\n    return new Promise((resolve, reject) => {\n\n        calendar.events.get({ \n            auth: serviceAccountAuth,\n            calendarId: config.GOOGLE_CALENDAR_ID,\n            eventId: eventID\n        }, (err, calendarResponse) => {              \n            if (err || calendarResponse.data.length > 0) {\n                reject(err || new Error('O horário solicitado entra em conflito com outro compromisso.'));\n            } else {\n                const resource = {\n                    start: {dateTime: dateTimeStart.toISOString()},\n                    end: {dateTime: dateTimeEnd.toISOString()},\n                };\n                calendar.events.patch({\n                    auth: serviceAccountAuth,\n                    calendarId: config.GOOGLE_CALENDAR_ID,\n                    eventId: eventID,\n                    resource: resource\n                }, (err, event) => {\n                    err ? reject(err) : resolve(event);\n                });\n            }\n        });\n    });\n};\n\nconst deleteCalendarEvent = (eventID) => {\n    return new Promise((resolve, reject) => {\n\n        calendar.events.delete({\n            auth: serviceAccountAuth,\n            calendarId: config.GOOGLE_CALENDAR_ID,\n            eventId: eventID\n        }, function(err) {\n            if (err) {\n                console.log('The API returned an error: ' + err);\n                reject();\n            }\n            resolve();\n        });\n    });\n};\n\nconst currentlyOpen = () => {\n    let date = new Date();\n    date.setHours(date.getHours() + parseInt('-03:00'.split(':')[0]));\n    date.setMinutes(date.getMinutes() + parseInt('-03:00'.split(':')[0][0] + '-03:00'.split(':')[1]));\n\n    return date.getDay() >= 1 &&\n      date.getDay() <= 5 &&\n      date.getHours() >= 8 &&\n      date.getHours() <= 18;\n};\n\nconst daysFromSlots = (startTime, endTime) => {\n    return new Promise((resolve) => {\n        const startDate = new Date(startTime);\n        const endDate = new Date(endTime);\n\n        startDate.setHours('0', '00', '00');\n        endDate.setHours('23', '59', '59');\n\n        const check = {\n            auth: serviceAccountAuth,\n            resource: {\n                items: [{id: config.GOOGLE_CALENDAR_ID}],\n                timeMin: startDate.toISOString(),\n                timeMax: endDate.toISOString(),\n                timeZone: '-03:00'\n            }\n        };\n        calendar.freebusy.query(check).then((data) => {\n            resolve(receivedSlotsDays(startDate, endDate, data.data.calendars[`${config.GOOGLE_CALENDAR_ID}`].busy));\n        });\n    });\n};\n\nconst receivedSlotsDays = (start, end, events) => {\n    return new Promise((resolve) => {\n        const freeSlots = []; \n        \n        events.forEach(function (event, index) {\n            if (index == 0 && start < event.start) {\n                freeSlots.push({startDate: start, endDate: event.start});\n            }\n            else if (index == 0) {\n                start = event.end;\n            }\n            else if (events[index - 1].end < event.start) {\n                freeSlots.push({startDate: events[index - 1].end, endDate: event.start});\n            }\n    \n            if (events.length == (index + 1) && event.end < start) {\n                freeSlots.push({startDate: event.end, endDate: start});\n            }\n        });\n        resolve(freeSlots);\n    });\n};\n\nconst slotsFromEvents = (startTime) => {\n    return new Promise((resolve) => {\n        const startDate = new Date(startTime);\n        const endDate = new Date(startTime);\n        startDate.setHours('08', '00', '00', '00');\n        endDate.setHours('18', '00', '00', '00');\n\n        const check = {\n            auth: serviceAccountAuth,\n            resource: {\n                items: [{id: config.GOOGLE_CALENDAR_ID}],\n                timeMin: startDate.toISOString(),\n                timeMax: endDate.toISOString(),\n                timeZone: '-03:00'\n            }\n        };\n        calendar.freebusy.query(check).then((data) => {\n            resolve(receivedSlotsHours(startDate, endDate, data.data.calendars[`${config.GOOGLE_CALENDAR_ID}`].busy));\n        });\n    });\n};\n\nconst receivedSlotsHours = (start, end, events) => {\n    return new Promise((resolve) => {\n        const start_org = start.toISOString();\n        const end_org = end.toISOString();\n        let freeSlots = [];\n        let start_time = moment(start_org).format();\n        let end_time = moment(end_org).format();\n        end_time = end_time.valueOf();\n        let appt_start_time = start_time;\n        appt_start_time = new Date(appt_start_time).getTime();\n        end_time = new Date(end_time).getTime();\n\n        while (appt_start_time < end_time) {\n            const appt_end_time = appt_start_time + 1799;\n    \n            let slot_available = true;\n            events.forEach((event) => {\n                const this_start = new Date(event['start']).getTime();\n                const this_end = new Date(event['end']).getTime();\n    \n                if ((appt_start_time >= this_start && appt_start_time < this_end) ||\n                (appt_end_time >= this_start && appt_end_time < this_end)) {\n                    slot_available = false;\n                    return false;\n                }\n            });\n    \n            if (slot_available) {\n                const date = new Date(parseInt(appt_start_time));\n                freeSlots.push(date);\n            }\n    \n            appt_start_time += (600 * 6000);\n        }\n        resolve(freeSlots);\n    });\n};\n\n\nexport default { \n    createCalendarEvent, \n    updateCalendarEvent, \n    deleteCalendarEvent, \n    currentlyOpen, \n    daysFromSlots, \n    slotsFromEvents \n};","import dialogflow from 'dialogflow';\nimport config from '../config/variables';\nimport utils from '../utils';\nimport send from '../app/send';\nimport receive from '../app/receive';\nimport structjson from '../utils/structjson';\n\nconst credentials = {\n    credentials: {\n        private_key: config.GOOGLE_PRIVATE_KEY,\n        client_email: config.GOOGLE_CLIENT_EMAIL\n    }\n};\n\nconst sessionClient = new dialogflow.SessionsClient(credentials);\n\n/**\n* Send all messages to DialogFlow\n* @param {*} sender\n* @param {*} textString\n* @param {*} params\n*/\nconst sendTextToDialogFlow = async (sender, textString, params) => {\n    send.sendTypingOn(sender);\n  \n    const sessionPath = sessionClient.sessionPath(\n        config.GOOGLE_PROJECT_ID,\n        utils.sessionIds.get(sender)\n    );\n\n    try {\n        const request = {\n            session: sessionPath,\n            queryInput: {\n                text: {\n                    text: textString,\n                    languageCode: config.GOOGLE_LANGUAGE_CODE\n                }\n            },\n            queryParams: {\n                payload: {\n                    data: params,\n                }\n            }\n        };\n      \n        const responses = await sessionClient.detectIntent(request);\n        const result = responses[0].queryResult;\n        receive.handleDialogFlowResponse(sender, result);\n    } catch (e) {\n        console.log('❌ [BOT CONSILIO] Error in process message in Dialogflow:');\n        console.log(e);\n    }\n};\n\nconst sendEventToDialogFlow = async (sender, event, params = {}) => {\n    send.sendTypingOn(sender);\n    const sessionPath = sessionClient.sessionPath(\n        config.GOOGLE_PROJECT_ID,\n        utils.sessionIds.get(sender)\n    );\n    try {\n        const request = {\n            session: sessionPath,\n            queryInput: {\n                event: {\n                    name: event,\n                    parameters: structjson.jsonToStructProto(params),\n                    languageCode: config.GOOGLE_LANGUAGE_CODE\n                }\n            }\n        };\n\n        const responses = await sessionClient.detectIntent(request);\n        const result = responses[0].queryResult;\n        receive.handleDialogFlowResponse(sender, result);\n    } catch (e) {\n        console.log('❌ [BOT CONSILIO] Error in process message in Dialogflow:');\n        console.log(e);\n    }\n};\n\nexport default {\n    sendTextToDialogFlow,\n    sendEventToDialogFlow\n};\n","'use strict';\nimport request from 'request';\nimport config from '../config/variables';\nimport mysql from '../config/mysql';\nimport utils from '../utils';\n\n/**\n * Send call to Facebook Graph API\n * @param {*} callback\n */\nconst sendCall = async (callback, i) => {\n    request(\n        {\n            uri: `${config.mPlatfom}/me/messages`,\n            qs: {\n                access_token: config.FB_PAGE_ACCESS_TOKEN\n            },\n            method: 'POST',\n            json: callback\n        },\n        function(error, response, body) {\n            if (!error && response.statusCode == 200) {\n                let recipientId = body.recipient_id;\n                let messageId = body.message_id;\n\n                utils.setSessionandUser(recipientId);\n\n                if(i < callback.length) sendCall(callback, i+1 );\n                \n                if (messageId) {\n                    console.log(\n                        '⚡️ [BOT CONSILIO] Successfully sent message with id %s to recipient %s',\n                        messageId,\n                        recipientId\n                    );\n                } else {\n                    console.log(\n                        '⚡️ [BOT CONSILIO] Successfully called Send API for recipient %s',\n                        recipientId\n                    );\n                }\n            } else {\n                console.error(\n                    '❌ [BOT CONSILIO] Failed calling Send API',\n                    response.statusCode,\n                    response.statusMessage,\n                    body.error\n                );\n            }\n        }\n    );\n};\n\nconst sendPassThread = (senderID) => {\n    request(\n        {\n            uri: 'https://graph.facebook.com/v2.6/me/pass_thread_control',\n            qs: { access_token: config.FB_PAGE_ACCESS_TOKEN },\n            method: 'POST',\n            json: {\n                recipient: {\n                    id: senderID\n                },\n                target_app_id: config.FB_PAGE_ID\n            }\n        },\n        (error, _res, body) => {\n            if (!error) {\n                console.log(\n                    '⚡️ [BOT CONSILIO] Send pass thrend request sent:',\n                    body\n                );\n            } else {\n                console.error('❌ [BOT CONSILIO] Unable to pass thread message:', error);\n            }\n        }\n    );\n};\n\nconst callMessengerProfileAPI = requestBody => {\n    console.log(\n        `⚡️ [BOT CONSILIO] Setting messenger profile for app ${config.FB_APP_ID}`\n    );\n    request(\n        {\n            uri: `${config.mPlatfom}/me/messenger_profile`,\n            qs: {\n                access_token: config.FB_PAGE_ACCESS_TOKEN\n            },\n            method: 'POST',\n            json: requestBody\n        },\n        (error, _res, body) => {\n            if (!error) {\n                console.log(\n                    '⚡️ [BOT CONSILIO] Messenger profile API request sent:',\n                    body\n                );\n            } else {\n                console.error('❌ [BOT CONSILIO] Unable to send message:', error);\n            }\n        }\n    );\n};\n\nconst getUserProfile = async senderPsid => {\n    try {\n        const userProfile = await this.callUserProfileAPI(senderPsid);\n\n        const keysUserProfile = Object.keys(userProfile);\n        const valuesUserProfile = Object.values(userProfile);\n    \n        for (let i = 0; i <= keysUserProfile.length; i += 1) {\n            if (Object.prototype.hasOwnProperty.call(valuesUserProfile, i)) {\n                const value = userProfile[i];\n                delete userProfile[i];\n                userProfile[i] = value;\n            }\n        }\n\n        return userProfile;\n    } catch (err) {\n        console.log('❌ [BOT CONSILIO] Fetch failed:', err);\n    }\n};\nconst callUserProfileAPI = senderPsid => {\n    return new Promise(function(resolve, reject) {\n        let body = [];\n\n        request({\n            uri: `${config.mPlatfom}/${senderPsid}`,\n            qs: {\n                access_token: config.FB_PAGE_ACCESS_TOKEN,\n                fields: 'first_name, last_name, gender, locale, timezone'\n            },\n            method: 'GET'\n        })\n            .on('response', function(response) {\n                // console.log(response.statusCode);\n\n                if (response.statusCode !== 200) {\n                    reject(Error(response.statusCode));\n                }\n            })\n            .on('data', function(chunk) {\n                body.push(chunk);\n            })\n            .on('error', function(error) {\n                console.error('❌ [BOT CONSILIO] Unable to fetch profile:' + error);\n                reject(Error('❌ [BOT CONSILIO] Network Error'));\n            })\n            .on('end', () => {\n                body = Buffer.concat(body).toString();\n                // console.log(JSON.parse(body));\n\n                resolve(JSON.parse(body));\n            });\n    });\n};\nconst callNLPConfigsAPI = () => {\n    console.log(\n        `⚡️ [BOT CONSILIO] Enable Built-in NLP for Page ${config.FB_PAGE_ID}`\n    );\n    request(\n        {\n            uri: `${config.mPlatfom}/me/nlp_configs`,\n            qs: {\n                access_token: config.FB_PAGE_ACCESS_TOKEN,\n                nlp_enabled: true\n            },\n            method: 'POST'\n        },\n        (error, _res, body) => {\n            if (!error) {\n                console.log('⚡️ [BOT CONSILIO] NLP request sent:', body);\n            } else {\n                console.error(\n                    '❌ [BOT CONSILIO] Unable to activate built-in NLP:',\n                    error\n                );\n            }\n        }\n    );\n};\nconst callFBAEventsAPI = (senderPsid, eventName) => {\n    // Construct the message body\n    let requestBody = {\n        event: 'CUSTOM_APP_EVENTS',\n        custom_events: JSON.stringify([\n            {\n                _eventName: 'postback_payload',\n                _value: eventName,\n                _origin: 'original_coast_clothing'\n            }\n        ]),\n        advertiser_tracking_enabled: 1,\n        application_tracking_enabled: 1,\n        extinfo: JSON.stringify(['mb1']),\n        FB_PAGE_ID: config.pageId,\n        page_scoped_user_id: senderPsid\n    };\n    request(\n        {\n            uri: `${config.mPlatfom}/${config.FB_APP_ID}/activities`,\n            method: 'POST',\n            form: requestBody\n        },\n        error => {\n            if (!error) {\n                console.log(`⚡️ [BOT CONSILIO] FBA event '${eventName}'`);\n            } else {\n                console.error(\n                    `❌ [BOT CONSILIO] Unable to send FBA event '${eventName}':` + error\n                );\n            }\n        }\n    );\n};\nconst callSubscriptionsAPI = customFields => {\n    console.log(\n        `⚡️ [BOT CONSILIO] Setting app ${config.FB_APP_ID} callback url to ${config.webhookUrl}`\n    );\n\n    let fields =\n    'messages, messaging_postbacks, messaging_optins, message_deliveries, messaging_referrals';\n\n    if (customFields !== undefined) {\n        fields = fields + ', ' + customFields;\n    }\n\n    //console.log(fields);\n\n    request(\n        {\n            uri: `${config.mPlatfom}/${config.FB_APP_ID}/subscriptions`,\n            qs: {\n                access_token: config.FB_APP_ID + '|' + config.FB_APP_SECRET,\n                object: 'page',\n                callback_url: config.APP_URL + '/webhook',\n                verify_token: config.FB_VERIFY_TOKEN,\n                fields: fields,\n                include_values: 'true'\n            },\n            method: 'POST'\n        },\n        (error, _res, body) => {\n            if (!error) {\n                console.log('⚡️ [BOT CONSILIO] Request sent:', body);\n            } else {\n                console.error('❌ [BOT CONSILIO] Unable to send message:', error);\n            }\n        }\n    );\n};\nconst callSubscribedApps = customFields => {\n    console.log(\n        `⚡️ [BOT CONSILIO] Subscribing app ${config.FB_APP_ID} to page ${config.FB_PAGE_ID}`\n    );\n\n    let fields =\n    'messages, messaging_postbacks, messaging_optins, \\\n      message_deliveries, messaging_referrals';\n\n    if (customFields !== undefined) {\n        fields = fields + ', ' + customFields;\n    }\n    //messaging_postbacksconsole.log(fields);\n    request(\n        {\n            uri: `${config.mPlatfom}/${config.FB_PAGE_ID}/subscribed_apps`,\n            qs: {\n                access_token: config.FB_PAGE_ACCESS_TOKEN,\n                subscribed_fields: fields\n            },\n            method: 'POST'\n        },\n        error => {\n            if (error) {\n                console.error('❌ [BOT CONSILIO] Unable to send message:', error);\n            }\n        }\n    );\n};\nconst addUser = (callback, userId) => {\n    request(\n        {\n            uri: `${config.mPlatfom}/${userId}`,\n            qs: {\n                access_token: config.FB_PAGE_ACCESS_TOKEN\n            }\n        },\n        async function(error, response, body) {\n            if (!error && response.statusCode == 200) {\n                var user = JSON.parse(body);\n                if (user.first_name.length > 0) {\n                    const consulta = await mysql.execQuery(`SELECT * FROM leads WHERE senderID= '${userId}'`).catch(err => {\n                        console.log('❌ ERRO: ', err);\n                    });\n                    console.log('CONSULTA: ', consulta);\n                    if (!consulta) {\n                        await mysql.execQuery(`INSERT INTO leads (senderID, first_name, last_name, profile_pic) VALUES ('${userId}', '${user.first_name}','${user.last_name}', '${user.profile_pic}')`).catch(err => {\n                            console.log('❌ ERRO: ', err);\n                        });\n                    }\n                    callback(user);\n                } else {\n                    console.log(\n                        '❌ [BOT CONSILIO] Cannot get data for fb user with id',\n                        userId\n                    );\n                }\n            } else {\n                console.error(response.error);\n            }\n        }\n    );\n};\n\nexport default {\n    sendCall,\n    sendPassThread,\n    callMessengerProfileAPI,\n    getUserProfile,\n    callUserProfileAPI,\n    callNLPConfigsAPI,\n    callFBAEventsAPI,\n    callSubscriptionsAPI,\n    callSubscribedApps,\n    addUser\n};\n","'use strict';\nconst uuid = require('uuid');\nimport facebookAPI from '../services/facebook.service';\n\n/**\n * Define is undefined\n * @param {Object} obj\n */\nconst isDefined = obj => {\n    if (typeof obj == 'undefined') {\n        return false;\n    }\n    if (!obj) {\n        return false;\n    }\n    return obj != null;\n};\n\n/**\n * Resolve after x time\n * @param {*} x \n */\nconst resolveAfterXSeconds = async (x) => {\n    return new Promise(resolve => {\n        setTimeout(() => {\n            resolve(x);\n        }, x * 1000);\n    });\n};\n\n/**\n * Set userid\n * @param {Number} senderID\n */\nconst sessionIds = new Map();\nconst usersMap = new Map();\n\nconst setSessionandUser = senderID => {\n    return new Promise(function(resolve, reject) {\n        if (!sessionIds.has(senderID)) {\n            sessionIds.set(senderID, uuid.v4());\n        }\n        if (!usersMap.has(senderID)) {\n            try {\n                facebookAPI.addUser(function(user) {\n                    resolve(usersMap.set(senderID, user));\n                }, senderID);\n            } catch (err) {\n                reject(err);\n            }\n        }\n    });\n};\n\n/**\n * Resolve after x time\n * @param {*} x \n */\nconst getEventID = async (event) => {\n    return new Promise(resolve => {\n        \n        var query = event.htmlLink.slice(1);\n        var partes = query.split('&');\n        let eventID = {};\n        partes.forEach(function (parte) {\n            var chaveValor = parte.split('=');\n            var valor = chaveValor[1];\n            eventID = valor;\n        });\n\n        const buf = Buffer.from(eventID, 'base64').toString('ascii');\n        eventID = buf.split(' ');\n\n        resolve(eventID[0]);\n    });\n};\n\nexport default {\n    isDefined,\n    setSessionandUser,\n    resolveAfterXSeconds,\n    getEventID,\n    sessionIds,\n    usersMap\n};\n","/**\n * Copyright 2017, Google, Inc.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *    http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview Utilities for converting between JSON and goog.protobuf.Struct\n * proto.\n */\n\n'use strict';\n\nfunction jsonToStructProto(json) {\n    const fields = {};\n    for (let k in json) {\n        fields[k] = jsonValueToProto(json[k]);\n    }\n\n    return {fields};\n}\n\nconst JSON_SIMPLE_TYPE_TO_PROTO_KIND_MAP = {\n    [typeof 0]: 'numberValue',\n    [typeof '']: 'stringValue',\n    [typeof false]: 'boolValue',\n};\n\nconst JSON_SIMPLE_VALUE_KINDS = new Set([\n    'numberValue',\n    'stringValue',\n    'boolValue',\n]);\n\nfunction jsonValueToProto(value) {\n    const valueProto = {};\n\n    if (value === null) {\n        valueProto.kind = 'nullValue';\n        valueProto.nullValue = 'NULL_VALUE';\n    } else if (value instanceof Array) {\n        valueProto.kind = 'listValue';\n        valueProto.listValue = {values: value.map(jsonValueToProto)};\n    } else if (typeof value === 'object') {\n        valueProto.kind = 'structValue';\n        valueProto.structValue = jsonToStructProto(value);\n    } else if (typeof value in JSON_SIMPLE_TYPE_TO_PROTO_KIND_MAP) {\n        const kind = JSON_SIMPLE_TYPE_TO_PROTO_KIND_MAP[typeof value];\n        valueProto.kind = kind;\n        valueProto[kind] = value;\n    } else {\n        console.warn('Unsupported value type ', typeof value);\n    }\n    return valueProto;\n}\n\nfunction structProtoToJson(proto) {\n    if (!proto || !proto.fields) {\n        return {};\n    }\n    const json = {};\n    for (const k in proto.fields) {\n        json[k] = valueProtoToJson(proto.fields[k]);\n    }\n    return json;\n}\n\nfunction valueProtoToJson(proto) {\n    if (!proto || !proto.kind) {\n        return null;\n    }\n\n    if (JSON_SIMPLE_VALUE_KINDS.has(proto.kind)) {\n        return proto[proto.kind];\n    } else if (proto.kind === 'nullValue') {\n        return null;\n    } else if (proto.kind === 'listValue') {\n        if (!proto.listValue || !proto.listValue.values) {\n            console.warn('Invalid JSON list value proto: ', JSON.stringify(proto));\n        }\n        return proto.listValue.values.map(valueProtoToJson);\n    } else if (proto.kind === 'structValue') {\n        return structProtoToJson(proto.structValue);\n    } else {\n        console.warn('Unsupported JSON value proto kind: ', proto.kind);\n        return null;\n    }\n}\n\nexport default {\n    jsonToStructProto,\n    structProtoToJson,\n};","module.exports = require(\"@babel/runtime/helpers/asyncToGenerator\");","module.exports = require(\"@babel/runtime/helpers/defineProperty\");","module.exports = require(\"@babel/runtime/helpers/typeof\");","module.exports = require(\"@babel/runtime/regenerator\");","module.exports = require(\"body-parser\");","module.exports = require(\"cors\");","module.exports = require(\"dialogflow\");","module.exports = require(\"dotenv\");","module.exports = require(\"express\");","module.exports = require(\"googleapis\");","module.exports = require(\"moment\");","module.exports = require(\"mysql\");","module.exports = require(\"pb-util\");","module.exports = require(\"request\");","module.exports = require(\"uuid\");"],"sourceRoot":""}